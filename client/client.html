<!DOCTYPE html>
<html>
<head>
    <title>Real Time AI Companion</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    
</head>
<body>
    <div class="container text-center mt-5">
        <div class="row">
            <div class="col-12 col-md-6 col-xl-4 mx-auto">
                <h1>Real Time AI Companion</h1>
                <input type="text" id="inputMessage" placeholder="Type your message...">
                <button onclick="sendMessage()">Send</button>
                <audio id="player" controls></audio>
                <p id="responseText"></p>
            </div>
        </div>
    </div>
    <script>
        let socket = new WebSocket("ws://localhost:8000/ws/1");

        socket.onopen = function(e) {
            console.log("[open] Connection established");
        };

        socket.onclose = function(event) {
            if (event.wasClean) {
                console.log(`[close] Connection closed cleanly, code=${event.code} reason=${event.reason}`);
            } else {
                console.log('[close] Connection died');
            }
        };

        socket.onerror = function(error) {
            console.log(`[error] ${error.message}`);
        };

        socket.onmessage = function(event) {
            if (typeof event.data === 'string') {
                if (event.data == "type:audio") {
                    // socket.binaryType = 'blob'; // Receive next message as Blob
                    // socket.onmessage = function(event) {
                    //     let blob = event.data; // This is already a Blob
                    //     let url = URL.createObjectURL(blob);
                    //     document.getElementById('player').src = url;
                    //     document.getElementById('player').play();
                    //     socket.binaryType = 'blob'; // Reset to receive next message as Blob
                    //     socket.onmessage = initialMessageHandler; // Reset message handler
                    // }
                    console.log("audio received")
                } else { // Assume the message is text
                    if (event.data == "\n") {
                        document.getElementById('inputMessage').value == ""
                    } else {
                        document.getElementById('responseText').textContent += event.data;
                    }
                }
            }
        };

        let initialMessageHandler = socket.onmessage;

        function sendMessage() {
            let message = document.getElementById('inputMessage').value;
            socket.send(message);
        }
    </script>
</body>
</html>
